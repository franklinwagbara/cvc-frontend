<div class="apply-container">
  <div class="apply-wrapper">
    <h1>NEW CVC CLEARANCE</h1>
    <div class="form-wrapper">
      <div class="form" [ngClass]="{ hide: !activateFirstSegment }">
        <form [formGroup]="vesselForm" class="main-form">
          <div class="first-segment" *ngIf="activateFirstSegment">
            <h5 class="w-full">Vessel Information</h5>
            <div class="flex flex-col">
              <span class="input-label"> IMO Number </span>
              <input
                [ngClass]="{
                  '!border-b border-2 !border !border-red-500':
                    vesselFormControl['imoNumber'].touched &&
                    vesselFormControl['imoNumber'].invalid
                }"
                autofocus
                type="text"
                class="rounded-r p-2"
                placeholder="IMO Number"
                formControlName="imoNumber"
                (blur)="validateImo()"
              />
            </div>
            <div class="flex flex-col">
              <div class="flex justify-between w-full input-label">
                <span class=""> Vessel Name </span>
                <span *ngIf="vesselInfo" class="text-green-600">
                  Vessel found
                </span>
              </div>
              <input
                type="text"
                [readOnly]="vesselInfo"
                [ngClass]="{
                  'bg-gray-100 cursor-not-allowed ': vesselInfo,
                  ' !border-b border-2 !border !border-red-500':
                    vesselFormControl['vesselName'].touched &&
                    vesselFormControl['vesselName'].invalid
                }"
                class="rounded-r p-2"
                placeholder="Vessel Name"
                formControlName="vesselName"
              />
            </div>

            <div class="flex flex-col">
              <span class="input-label"> Mother Vessel </span>
              <input
                [ngClass]="{
                  '!border-b border-2 !border !border-red-500':
                    vesselFormControl['motherVessel'].touched &&
                    vesselFormControl['motherVessel'].invalid
                }"
                type="text"
                class="rounded-r p-2"
                placeholder="Mother Vessel Name"
                formControlName="motherVessel"
              />
            </div>

            <div class="flex flex-col">
              <span class="input-label"> Loading Port </span>
              <input
                [ngClass]="{
                  '!border-b border-2 !border !border-red-500':
                    vesselFormControl['loadingPort'].touched &&
                    vesselFormControl['loadingPort'].invalid
                }"
                type="text"
                class="rounded-r p-2"
                placeholder="Loading Port"
                formControlName="loadingPort"
              />
            </div>

            <div class="flex flex-col">
              <span class="input-label"> Jetty </span>
              <input
                [ngClass]="{
                  '!border-b border-2 !border !border-red-500':
                    vesselFormControl['jetty'].touched &&
                    vesselFormControl['jetty'].invalid
                }"
                type="text"
                class="rounded-r p-2"
                placeholder="Discharge Port"
                formControlName="jetty"
              />
            </div>

            <div class="flex flex-col">
              <span class="input-label"> Vessel Type </span>
              <select
                [ngClass]="{
                  'bg-gray-100 cursor-not-allowed ': vesselInfo,
                  ' !border-b border-2 !border !border-red-500':
                    vesselFormControl['vesselTypeId'].touched &&
                    vesselFormControl['vesselTypeId'].invalid
                }"
                type="text"
                class="rounded-r p-2"
                formControlName="vesselTypeId"
              >
                <option value="" [selected]="true">
                  -- Select Vessel Type --
                </option>
                <option *ngFor="let vt of vesselTypes" [ngValue]="vt.id">
                  {{ vt.name }}
                </option>
              </select>
            </div>

            <div class="flex flex-col">
              <mat-form-field>
                <mat-label>Estimated Time of Arrival (ETA) </mat-label>
                <div class="flex">
                  <input
                    matInput
                    formControlName="eta"
                    [matDatepicker]="etaDatePicker"
                    [min]="dateValidation.min"
                  />
                  <mat-datepicker-toggle
                    matIconSuffix
                    [for]="etaDatePicker"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #etaDatePicker></mat-datepicker>
                </div>
              </mat-form-field>
            </div>

            <button
              *ngIf="isNext"
              class="btn-next"
              mat-raised-button
              (click)="updateState(2)"
            >
              Next
            </button>
          </div>
        </form>
      </div>

      <div class="second-segment" *ngIf="activateSecondSegment">
        <div class="appDepotForm">
          <form class="appDepotForm depot-form" [formGroup]="appDepotForm">
            <h5 class="w-full">Destination Depot</h5>
            <div class="flex flex-col">
              <span class="input-label"> Depot Name </span>
              <select
                type="text"
                class="border border-t border-b rounded-r p-2"
                formControlName="depotId"
              >
                <option value="" [selected]="true">-- Select Depot --</option>
                <option *ngFor="let d of depots" [ngValue]="d.id">
                  {{ d.name }}
                </option>
              </select>
            </div>

            <div class="flex flex-col">
              <span class="input-label"> Volume to Discharge </span>
              <input
                type="number"
                min="0"
                class="border border-t border-b rounded-r p-2"
                placeholder="Volume"
                formControlName="volume"
              />
            </div>

            <div class="flex flex-col">
              <span class="input-label"> Product </span>
              <select
                type="text"
                class="border border-t border-b rounded-r p-2"
                formControlName="productId"
              >
                <option value="" [selected]="true">-- Select Product --</option>
                <option *ngFor="let p of products" [ngValue]="p.id">
                  {{ p.name }}
                </option>
              </select>
            </div>

            <button
              mat-stroked-button
              color="primary"
              class="m-4"
              [disabled]="appDepotForm.invalid ? true : null"
              (click)="addAppDepot()"
            >
              Add Depot
            </button>

            <div *ngIf="selectedAppDepots?.length > 0">
              <table class="table table-auto data-table">
                <thead>
                  <tr>
                    <th>Depot Name</th>
                    <th>Volumne</th>
                    <th>Product Name</th>
                  </tr>
                </thead>

                <tbody>
                  <tr *ngFor="let t of selectedAppDepots">
                    <td>{{ t.name }}</td>
                    <td>{{ t.volume }}</td>
                    <td>{{ t.product }}</td>
                    <td>
                      <button
                        (click)="removeDepot(t)"
                        mat-flat-button
                        color="accent"
                      >
                        Remove
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div>
              <button
                class="btn-back"
                mat-raised-button
                (click)="updateState(1)"
              >
                Back
              </button>

              <button
                *ngIf="selectedAppDepots.length > 0"
                mat-raised-button
                color="primary"
                class="primary"
                (click)="submit()"
              >
                Continue
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
